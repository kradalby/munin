---
kind: pipeline
type: exec
name: build

platform:
  os: darwin
  arch: amd64

steps:
- name: lint
  when:
    branch:
    - master
  commands:
    - brew install sourcery swiftlint swiftformat
    - make lint

- name: build
  when:
    branch:
    - master
  commands:
    - make build

- name: install local
  when:
    branch:
    - master
  commands:
    - make install

- name: publish build
  when:
    branch:
    - master
  commands:
    - make publish

# - name: notify
#   pull: if-not-exists
#   image: drillster/drone-email
#   settings:
#     from: drone@drone.fap.no
#     host: smtp.fap.no
#     port: 25
#     recipients:
#     - kradalby@kradalby.no
#     skip_verify: true
#   when:
#     status:
#     - success
#     - changed
#     - failure

# ---
# kind: pipeline
# name: lint-in-docker
# 
# steps:
# - name: lint
#   pull: if-not-exists
#   image: kradalby/swift-mint:latest
#   commands:
#   - mint install realm/SwiftLint
#   - mint install nicklockwood/SwiftFormat
#   - swiftlint
#   - swiftformat --lint Sources
# 
# - name: notify
#   pull: if-not-exists
#   image: drillster/drone-email
#   settings:
#     from: drone@drone.fap.no
#     host: smtp.fap.no
#     port: 25
#     recipients:
#     - kradalby@kradalby.no
#     skip_verify: true
#   when:
#     status:
#     - success
#     - changed
#     - failure
